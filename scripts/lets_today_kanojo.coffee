# Description:
#   lets today kanojo.
#
# Commands:
#   hubot lets_today_kanojo
#   hubot lets_random_kanojo
#

client  = require 'cheerio-httpcli'

# 2016/7/25まで全部
kanojos = ['00051568','00051567','00051566','00051565','00051564','00051562','00051561','00051560','00051559','00051558','00051557','00051556','00051555','00051353','00051352','00051351','00051350','00051349','00051348','00051347','00051346','00051345','00051344','00051343','00051342','00051341','00051340','00051120','00051119','00051118','00051117','00051116','00051115','00051114','00051113','00051111','00051109','00051098','00051097','00051096','00051092','00050892','00050891','00050890','00050889','00050888','00050887','00050886','00050885','00050884','00050883','00050882','00050881','00050880','00050879','00050669','00050668','00050667','00050666','00050665','00050664','00050663','00050662','00050661','00050660','00050659','00050658','00050657','00050656','00050439','00050438','00050440','00050437','00050436','00050435','00050434','00050433','00050432','00050431','00050430','00050429','00050428','00050427','00050272','00050271','00050270','00050269','00050266','00050264','00050263','00050262','00050261','00050260','00050259','00050258','00050257','00050256','00050079','00050078','00050077','00050076','00050075','00050074','00050073','00050072','00050071','00050070','00050069','00050068','00050067','00050066','00050038','00050037','00050036','00050035','00050034','00048341','00048340','00048339','00048338','00048337','00048336','00048335','00048334','00048333','00048054','00048053','00048052','00048051','00048050','00048049','00048048','00048047','00048046','00048045','00048044','00048043','00048042','00048041','00047739','00047738','00047737','00047736','00047735','00047734','00047733','00047732','00047731','00047730','00047729','00047728','00047727','00047726','00047452','00047451','00047450','00047449','00047448','00047447','00047446','00047445','00047444','00047443','00047442','00047441','00047440','00047439','00047132','00047131','00047130','00047129','00047128','00047127','00047126','00047125','00047124','00047123','00047122','00047121','00047120','00047119','00046967','00046966','00046965','00046964','00046963','00046962','00046961','00046960','00046959','00046958','00046957','00046956','00046955','00046954','00046595','00046594','00046593','00046592','00046591','00046590','00046589','00046588','00046587','00046586','00046585','00046584','00046583','00046582','00046473','00046472','00046471','00046470','00046469','00046468','00046467','00046466','00046465','00046464','00046463','00046462','00046461','00046460','00046199','00046198','00046197','00046196','00046195','00046194','00046193','00046192','00046191','00046190','00046189','00046188','00046187','00046186','00045953','00045952','00045951','00045950','00045949','00045948','00045947','00045946','00045945','00045944','00045943','00045942','00045941','00045940','00045627','00045626','00045625','00045624','00045623','00045622','00045620','00045619','00045618','00045617','00045616','00045615','00045613','00045409','00045408','00045407','00045406','00045405','00045404','00045403','00045402','00045401','00045400','00045399','00045398','00045397','00045168','00045167','00045166','00045165','00045164','00045163','00045162','00045161','00045160','00045159','00045158','00045157','00045156','00044905','00044904','00044903','00044902','00044901','00044900','00044899','00044898','00044897','00044896','00044895','00044894','00044893','00044696','00044694','00044693','00044692','00044691','00044690','00044689','00044688','00044687','00044686','00044685','00044684','00044683','00044682','00044464','00044463','00044462','00044461','00044460','00044459','00044458','00044284','00044283','00044282','00044281','00044280','00044279','00044278','00044277','00044275','00044274','00044273','00044272','00044271','00044061','00044060','00044059','00044058','00044057','00044056','00044055','00044054','00044053','00044052','00044051','00044050','00044049','00044048','00043741','00043740','00043739','00043738','00043737','00043736','00043735','00043734','00043733','00043732','00043731','00043730','00043729','00043728','00043527','00043526','00043525','00043524','00043523','00043522','00043521','00043520','00043519','00043517','00043516','00043515','00043514','00043072','00043071','00043044','00043043','00043042','00043041','00043040','00043039','00043038','00043037','00043035','00043034','00043033','00043032','00042796','00042795','00042794','00042793','00042792','00042791','00042790','00042789','00042788','00042786','00042785','00042784','00042783','00042782','00042351','00042350','00042349','00042348','00042347','00042346','00042345','00042344','00042342','00042341','00042340','00042339','00042338','00042177','00042176','00042175','00042174','00042173','00042172','00042171','00042170','00042169','00042168','00042167','00042166','00042165','00042164','00041988','00041987','00041986','00041984','00041983','00041982','00041981','00041980','00041979','00041978','00041977','00041976','00041975','00041711','00041710','00041709','00041708','00041707','00041706','00041705','00041704','00041703','00041702','00041701','00041700','00041699','00041697','00041588','00041587','00041586','00041585','00041584','00041583','00041582','00041517','00041516','00041515','00041514','00041513','00041512','00041511','00041206','00041205','00041204','00041203','00041202','00041201','00041200','00041199','00041198','00041197','00041196','00041195','00041194','00041193','00040991','00040990','00040989','00040988','00040987','00040986','00040985','00040984','00040983','00040982','00040981','00040980','00040979','00040978','00040670','00040669','00040668','00040667','00040666','00040665','00040664','00040663','00040662','00040661','00040660','00040659','00040658','00040638','00040531','00040529','00040527','00040525','00040523','00040522','00040521','00040519','00040518','00040517','00040458','00040440','00040427','00040196','00040195','00040194','00040193','00040192','00040191','00040190','00040189','00040188','00040187','00040186','00040185','00040184','00040173','00040004','00040003','00040002','00040001','00040000','00039999','00039998','00039997','00039996','00039995','00039993','00039992','00039991','00039984','00039898','00039896','00039895','00039894','00039893','00039892','00039891','00039890','00039889','00039888','00039887','00039822','00039796','00039777','00039744','00039743','00039742','00039669','00039668','00039667','00039666','00039521','00039520','00039519','00039518','00039517','00039516','00039515','00039384','00039383','00039382','00039337','00039336','00039312','00039311','00039310','00039309','00039140','00039138','00039137','00039136','00038973','00038972','00038970','00038969','00038967','00038966','00038965','00038964','00038963','00038962','00038961','00038960','00038959','00038958','00038624','00038623','00038622','00038621','00038620','00038619','00038618','00038617','00038616','00038615','00038614','00038613','00038612','00038611','00038502','00038501','00038500','00038499','00038498','00038497','00038496','00038494','00038493','00038492','00038491','00038490','00038489','00038488','00038342','00038341','00038340','00038339','00038338','00038337','00038336','00038335','00038334','00038333','00038332','00038331','00038330','00038329','00038051','00038050','00038049','00038048','00038047','00038046','00038045','00038044','00038043','00038042','00038040','00038039','00038038','00038032','00037718','00037717','00037716','00037715','00037714','00037713','00037712','00037711','00037710','00037709','00037708','00037706','00037705','00037704','00037645','00037644','00037643','00037642','00037641','00037640','00037639','00037638','00037637','00037636','00037635','00037634','00037633','00037632','00037512','00037511','00037510','00037509','00037508','00037507','00037506','00037505','00037504','00037503','00037502','00037501','00037500','00037220','00037219','00037218','00037217','00037216','00037215','00037214','00037213','00037212','00037211','00037210','00037209','00037208','00037053','00037052','00037051','00037050','00037049','00037048','00037046','00037045','00037044','00037043','00037040','00037039','00036741','00036740','00036739','00036738','00036737','00036736','00036735','00036734','00036733','00036732','00036731','00036730','00036729','00036728','00036719','00036706','00036695','00036694','00036659','00036658','00036657','00036656','00036599','00036598','00036597','00036596','00036552','00036551','00036550','00036379','00036378','00036377','00036376','00036375','00036374','00036373','00036372','00036371','00036370','00036369','00036368','00036367','00036366','00036104','00036103','00036102','00036101','00036100','00036099','00036098','00036097','00036096','00036095','00036094','00036093','00036092','00036091','00036012','00036011','00036010','00036009','00036008','00036007','00036006','00036005','00036004','00036003','00036002','00036001','00036000','00035988','00035775','00035774','00035773','00035772','00035771','00035770','00035769','00035768','00035767','00035766','00035765','00035764','00035763','00035745','00035608','00035607','00035606','00035605','00035604','00035603','00035602','00035601','00035600','00035599','00035598','00035597','00035596','00035585','00035260','00035259','00035258','00035257','00035256','00035255','00035254','00035253','00035252','00035251','00035250','00035249','00035248','00035247','00035060','00035059','00035058','00035057','00035056','00035055','00035054','00035053','00035052','00035051','00035050','00035049','00035048','00035043','00034679','00034678','00034669','00034668','00034667','00034666','00034665','00034664','00034663','00034662','00034661','00034659','00034593','00034592','00034591','00034590','00034497','00034496','00034495','00034494','00034493','00034492','00034491','00034490','00034488','00034487','00034440','00034439','00034438','00034350','00034349','00034348','00034347','00034346','00034345','00034344','00034343','00034342','00034341','00034204','00034156','00034155','00034154','00034153','00034152','00034151','00034126','00034029','00034028','00034027','00034026','00034025','00034024','00034023','00033937','00033936','00033935','00033934','00033933','00033932','00033931','00033930','00033929','00033928','00033927','00033926','00033925','00033924','00033756','00033755','00033754','00033753','00033752','00033751','00033750','00033749','00033748','00033747','00033746','00033745','00033744','00033743','00033435','00033434','00033433','00033432','00033431','00033430','00033429','00033428','00033427','00033426','00033425','00033424','00033407','00033154','00033153','00033152','00033151','00033150','00033149','00033148','00033147','00033146','00033145','00033144','00033143','00033142','00033133','00032848','00032847','00032846','00032845','00032844','00032843','00032842','00032841','00032834','00032833','00032832','00032831','00032830','00032829','00032715','00032714','00032713','00032712','00032807','00032711','00032710','00032709','00032708','00032707','00032706','00032705','00032704','00032703','00032702','00032493','00032492','00032491','00032490','00032489','00032488','00032487','00032486','00032485','00032484','00032483','00032482','00032481','00032480','00032159','00032158','00032157','00032156','00032155','00032154','00032153','00032152','00032151','00032150','00032149','00032148','00032147','00032146','00032089','00031977','00031976','00031975','00031974','00031973','00031972','00031971','00031967','00031966','00031965','00031964','00031963','00031962','00031961','00031686','00031685','00031684','00031683','00031682','00031681','00031680','00031679','00031677','00031676','00031675','00031674','00031673','00031672','00031522','00031521','00031520','00031516','00031515','00031514','00031513','00031512','00031511','00031510','00031509','00031508','00031506','00031505','00031218','00031217','00031216','00031215','00031214','00031213','00031212','00031211','00031210','00031209','00031208','00031207','00031206','00031205','00031015','00031014','00031013','00031012','00031011','00031010','00031009','00031008','00031007','00031006','00031005','00031004','00031003','00031002','00030582','00030581','00030580','00030579','00030578','00030577','00030576','00030575','00030574','00030573','00030572','00030571','00030570','00030569','00030322','00030321','00030320','00030319','00030318','00030317','00030316','00030315','00030314','00030313','00030312','00030311','00030309','00030058','00030057','00030056','00030055','00030054','00030053','00030052','00030051','00030050','00030049','00030048','00030047','00030046','00029824','00029822','00029820','00029817','00029815','00029813','00029811','00029809','00029807','00029805','00029803','00029741','00029739','00029738','00029545','00029544','00029543','00029542','00029541','00029540','00029539','00029538','00029537','00029536','00029535','00029534','00029533','00029532','00029400','00029399','00029398','00029397','00029396','00029395','00029277','00029276','00029275','00029274','00029273','00029272','00029270','00029278','00029139','00029138','00029137','00029136','00029135','00029134','00029133','00029038','00029037','00029036','00029035','00029034','00029033','00029032','00028923','00028922','00028921','00028920','00028919','00028918','00028917','00028916','00028915','00028914','00028913','00028642','00028641','00028640','00028639','00028638','00028637','00028636','00028635','00028634','00028633','00028523','00028524','00028530','00028529','00028525','00028526','00028527','00028532','00028528','00028531','00028412','00028411','00028408','00028407','00028406','00028405','00028404','00028384','00028383','00028276','00028275','00028274','00028273','00028272','00028271','00028270','00028235','00028234','00028233','00028232','00028231','00028208','00028207','00028142','00028141','00028140','00028139','00028086','00028085','00028084','00027795','00027794','00027793','00027792','00027791','00027790','00027789','00027742','00027741','00027740','00027739','00027738','00027701','00027700','00027607','00027606','00027605','00027604','00027603','00027360','00027356','00027354','00027352','00027351','00027350','00027349','00027348','00027347','00027346','00027345','00027344','00027343','00027342','00027341','00027213','00027212','00027211','00027210','00027209','00027208','00027207','00027204','00027133','00027132','00027131','00027130','00027129','00027093','00027092','00027091','00027090','00027089','00027002','00027000','00026998','00026996','00026994','00026992','00026990','00026887','00026886','00026885','00026883','00026882','00026881','00026880','00026879','00026878','00026877','00026876','00026875','00026874','00026873','00026774','00026773','00026772','00026771','00026770','00026732','00026731','00026730','00026729','00026728','00026636','00026635','00026634','00026633','00026632','00026631','00026630','00026629','00026628','00026551','00026550','00026549','00026548','00026547','00026546','00026545','00026544','00026543','00026542','00026541','00026453','00026452','00026451','00026450','00026449','00026448','00026447','00026422','00026421','00026420','00026419','00026412','00026399']

module.exports = (robot) ->
  robot.respond /lets_today_kanojo$/i, (msg) ->
    client.fetch 'http://r25.jp/rensai/todaygirl/', {}, (error, $, response) ->
      article_list = $('.main-clumn-left-list .thumb-link-list li')
      now = new Date()
      ymd = now.getFullYear() + "." + ('0' + (now.getMonth() + 1)).slice(-2) + "." + ('0' + now.getDate()).slice(-2)
      for article, i in article_list
        if $('.right-top-date', article).text() == ymd
          msg.send($('a', article).attr('href'))
          return
      msg.send("今日はマダ")

  robot.respond /lets_random_kanojo/i, (msg) ->
    msg.send('http://r25.jp/entertainment/' + kanojos[Math.floor(Math.random() * (kanojos.length + 1))] + '/')


#  robot.respond /lets_today_kanojo_all/i, (msg) ->
#    client.fetch 'http://r25.jp/rensai/todaygirl/', {}, (error, $, response) ->
#      sleep(10000)
#      display_list(msg, $)
#      get_next(msg, $)
#
#get_next = (msg, $) -> 
#  client.fetch $('a ', $('.pager li:last-child')).attr('href'), {}, (error, $, response) ->
#    sleep(10000)
#    display_list(msg, $)
#    if $('.pager li:last-child').text() == "＞"
#      get_next(msg, $)
#
#display_list = (msg, $) ->
#  article_list = $('.main-clumn-left-list .thumb-link-list li')
#  for article, i in article_list
#    msg.send($('.right-top-date', article).text() + "\t" + $('a', article).attr('href'))
#
#sleep = (ms) ->
#  start = new Date().getTime()
#  continue while new Date().getTime() - start < ms
